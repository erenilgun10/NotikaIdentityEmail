@using NotikaIdentityEmail.Models.CommentViewModels
@using NotikaIdentityEmail.Enum

@model CommentViewModel

@{
    ViewData["Title"] = "Kullanıcı Yorum İşlemleri";
    Layout = "~/Views/UserLayout/Index.cshtml";
    var count = (Model.PageNumber - 1) * Model.PageSize;
}

<div class="form-element-area">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="form-element-list">
                    <div class="basic-tb-hd">
                        <h2>Kullanıcı Yorum İşlemleri</h2>
                        <p>Yorumları listeler ve statülerini güncelleyebilirsiniz.</p>
                    </div>
                    <div class="row">

                        <table class="table table-bordered">
                            <tr>
                                <th>#</th>
                                <th>Kullanıcı</th>
                                <th>Yorum</th>
                                <th>Durum</th>
                                <th>Yorumu Sil</th>
                                <th>Durum Güncelle</th>
                            </tr>

                            @if (Model.Comments != null && Model.Comments.Any())
                            {
                                @foreach (var item in Model.Comments)
                                {
                                    count++;
                                    <tr>
                                        <td>@count</td>
                                        <td>@item.AppUser?.FirstName @item.AppUser?.LastName</td>
                                        <td>@item.CommentDetail</td>
                                        <td>@item.CommentStatus</td>

                                        <td>
                                            <a asp-controller="Comment"
                                               asp-action="CommentDelete"
                                               asp-route-id="@item.CommentId"
                                               class="btn btn-danger btn-sm">
                                                Sil
                                            </a>
                                        </td>

                                        <td>
                                            <form asp-controller="Comment"
                                                  asp-action="UpdateCommentStatus"
                                                  method="post"
                                                  class="form-inline d-flex">
                                                @Html.AntiForgeryToken()

                                                <input type="hidden" name="commentId" value="@item.CommentId" />
                                                <input type="hidden" name="pageNumber" value="@Model.PageNumber" />
                                                <input type="hidden" name="pageSize" value="@Model.PageSize" />

                                                <select name="status" class="form-control form-control-sm">
                                                    @foreach (StatusEnum status in Enum.GetValues(typeof(StatusEnum)))
                                                    {
                                                        if (status == item.CommentStatus)
                                                        {
                                                            <option value="@((int)status)" selected="selected">
                                                                @status
                                                            </option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@((int)status)">
                                                                @status
                                                            </option>
                                                        }
                                                    }
                                                </select>

                                                <button type="submit" class="btn btn-success btn-sm" style="margin-left:5px;">
                                                    Güncelle
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="6">Gösterilecek yorum bulunamadı.</td>
                                </tr>
                            }
                        </table>

                        <div class="text-center" style="margin-top:15px;">
                            <ul class="pagination">
                                @if (Model.HasPrevious)
                                {
                                    <li class="page-item">
                                        <a class="page-link"
                                           asp-action="UserCommentList"
                                           asp-route-pageNumber="@(Model.PageNumber - 1)"
                                           asp-route-pageSize="@Model.PageSize">
                                            Önceki
                                        </a>
                                    </li>
                                }

                                @for (int i = 1; i <= Model.TotalPages; i++)
                                {
                                    <li class="page-item @(i == Model.PageNumber ? "active" : "")">
                                        <a class="page-link"
                                           asp-action="UserCommentList"
                                           asp-route-pageNumber="@i"
                                           asp-route-pageSize="@Model.PageSize">
                                            @i
                                        </a>
                                    </li>
                                }

                                @if (Model.HasNext)
                                {
                                    <li class="page-item">
                                        <a class="page-link"
                                           asp-action="UserCommentList"
                                           asp-route-pageNumber="@(Model.PageNumber + 1)"
                                           asp-route-pageSize="@Model.PageSize">
                                            Sonraki
                                        </a>
                                    </li>
                                }
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
